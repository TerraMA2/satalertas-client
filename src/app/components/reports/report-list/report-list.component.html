<p-table (onHeaderCheckboxToggle)="onHeaderCheckboxToggle($event)"
         (onLazyLoad)="onLazyLoad($event)"
         (onRowExpand)="onRowExpand($event)"
         (onRowCollapse)="onRowCollapse($event)"
         (onRowSelect)="onRowSelect()"
         (onRowUnselect)="onRowUnselect()"
         (onSort)="onSort($event)"
         (onPage)="onPage($event)"
         [(selection)]="selectedProperties"
         [columns]="selectedColumns"
         [lazy]="true"
         [loading]="isLoading"
         [paginator]="true"
         [reorderableColumns]="true"
         [resizableColumns]="true"
         [responsive]="true"
         [rowTrackBy]="trackById"
         [rows]="selectedRowsPerPage"
         [rowHover]="true"
         [first]="first"
         [sortField]="sortField"
         [sortOrder]="sortOrder"
         [defaultSortOrder]="defaultSortOrder"
         [expandedRowKeys]="expandedRowKey"
         [scrollHeight]="'80vh'"
         [scrollable]="true"
         [totalRecords]="totalRecords"
         [value]="tableData"
         [dataKey]="'gid'"
         [resetPageOnSort]="false"
         [exportFilename]="'SatÃ©lites_Alertas_CAR'"
         [loadingIcon]="'fas fa-circle-notch color-black'"
         [rowExpandMode]="'single'">
    <ng-template pTemplate="caption">
        <div class="p-grid p-nogutter">

            <div class="p-col-12 p-md-6 p-col-nogutter">

                <div class="float-left">

                    <p-multiSelect [(ngModel)]="selectedColumns"
                                   [options]="columns"
                                   (onChange)="onColumnsChanged($event)"
                                   [style]="{minWidth: '200px'}"
                                   defaultLabel="{{ 'selectColumns' | translate}}"
                                   optionLabel="header"
                                   selectedItemsLabel="{0} columns selected">
                    </p-multiSelect>

                    &nbsp;&nbsp;

                    <p-dropdown
                            (onChange)="onRowsPerPageChange($event)"
                            [(ngModel)]="selectedRowsPerPage"
                            [options]="rowsPerPage"
                            [style]="{minWidth: '100px'}">
                    </p-dropdown>

                    &nbsp;&nbsp;


                    <p-dropdown #selectedLayer
                                (onChange)="onLayerChange(selectedLayer)"
                                [(ngModel)]="selectedLayerValue"
                                [options]="reportLayers">
                    </p-dropdown>

                </div>
            </div>

            <div class="p-col-12 p-md-6 p-col-nogutter">

                <div class="float-right">

                    <p-multiSelect [(ngModel)]="selectedFormats"
                                   [disabled]="isExportDisabled || isLoading"
                                   [filter]="false"
                                   [options]="formats"
                                   [style]="{minWidth: '16rem'}"
                                   defaultLabel="{{'selectFormat' | translate}}"
                                   maxSelectedLabels="4">
                    </p-multiSelect>

                    &nbsp;&nbsp;

                    <p-button
                            (click)="onExportClick()"
                            [disabled]="isExportDisabled || isLoading"
                            icon="fas fa-save"
                            iconPos="left"
                            label="{{'export' | translate}}"
                            pTooltip="{{ 'exportSelected' | translate }}"
                            styleClass="p-button-raised"
                            tooltipPosition="left">
                    </p-button>

                </div>

            </div>

        </div>
    </ng-template>

    <ng-template let-columns pTemplate="colgroup">
        <colgroup>
            <col *ngFor="let col of columns">
        </colgroup>
    </ng-template>
    <ng-template let-columns pTemplate="header">
        <tr>
            <th style="width: 2.5em"></th>
            <th style="width: 3em"></th>
            <th style="width: 3em">
                <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
            </th>
            <th *ngFor="let col of columns; trackBy: trackById" [pSortableColumn]="col.field" pReorderableColumn
                pResizableColumn>
                {{col.header}}
                <p-sortIcon [field]="col.field"></p-sortIcon>
            </th>
            <th></th>
        </tr>
    </ng-template>

    <ng-template let-columns="columns"
                 let-expanded="expanded"
                 let-rowData
                 pTemplate="body">
        <tr [pSelectableRow]="rowData">
            <td class="ui-resizable-column" style="width: 2.5em">
                <a [pRowToggler]="rowData">
                    <i [ngClass]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"></i>
                </a>
            </td>
            <td class="ui-resizable-column" style="width: 3em">
                <i [ngClass]="rowData.has_pdf ? 'pi pi-file-pdf' : 'pi pi-file-o'" style="font-size: 1.6em;"></i>
            </td>
            <td class="ui-resizable-column" style="width: 3em">
                <p-tableCheckbox [value]="rowData"></p-tableCheckbox>
            </td>
            <td *ngFor="let col of columns; trackBy: trackById" class="ui-resizable-column"
                pTooltip="{{ rowData[col.field] }}"
                style="overflow: hidden;word-break: break-all;" tooltipPosition="top">
                {{rowData[col.field]}}
            </td>
            <td class="ui-resizable-column">
                <button *ngIf="showDeter"
                        class="p-button-raised p-button-outlined p-button-secondary view-report-icon"
                        pButton
                        pTooltip="{{ 'viewDeterReport' | translate }}"
                        routerLink="/reports/deter/{{getRegister(rowData)}}"
                        tooltipPosition="top">
                    <img src="assets/img/ico/deter32x32.png"/>
                </button>
                <button *ngIf="showProdes"
                        class="p-button-raised p-button-outlined p-button-secondary view-report-icon icon-margin"
                        pButton
                        pTooltip="{{ 'viewProdesReport' | translate }}"
                        routerLink="/reports/prodes/{{getRegister(rowData)}}"
                        tooltipPosition="top">
                    <img src="assets/img/ico/prodes32x32.png"/>
                </button>
                <button *ngIf="showBurn"
                        class="p-button-raised p-button-outlined p-button-secondary view-report-icon icon-margin"
                        pButton
                        pTooltip="{{ 'viewBurnedReport' | translate }}"
                        routerLink="/reports/queimada/{{getRegister(rowData)}}"
                        tooltipPosition="top">
                    <img src="assets/img/ico/queima.ico"/>
                </button>
                <button class="p-button-raised p-button-outlined p-button-secondary view-report-icon icon-margin"
                        pButton
                        pTooltip="{{ 'viewSynthesis' | translate }}"
                        routerLink="/synthesis/{{getRegister(rowData)}}">
                    <i class="fa fa-file-invoice synthesis-link"></i>
                </button>
            </td>
        </tr>
    </ng-template>

    <ng-template pTemplate="rowexpansion">
        <tr>
            <td [attr.colspan]="selectedColumns.length + 4">
                <div *ngIf="reports.length > 0" class="p-grid text-center">
                    <div *ngFor="let report of reports; trackBy: trackById" class="p-col-2">
                        <div (click)="getReport(report)"
                             class="report-card"
                             pTooltip="{{'downloadReport' | translate}}"
                             tooltipPosition="top">
                            <p>{{report.name}}</p>
                            <p>{{report.createdAt | date:'dd/MM/yyyy HH:mm:ss' }}</p>
                        </div>
                    </div>
                </div>
                <div *ngIf="reports.length === 0" class="p-grid text-center">
                    <h4 class="p-col text-center">{{ 'noReportFound' | translate}}</h4>
                </div>
            </td>
        </tr>
    </ng-template>

    <ng-template let-state pTemplate="paginatorright">
        <strong>{{state.totalRecords | number:'1.0-4':'pt' }} {{'registers' | translate}}</strong>
        &nbsp;
        <strong>{{selectedProperties ? selectedProperties?.length : '0' }} {{'selecteds' | translate}}</strong>
    </ng-template>

    <ng-template let-columns pTemplate="emptymessage">
        <tr>
            <td [attr.colspan]="columns.length">
                {{ 'noRecordsFound' | translate }}
            </td>
        </tr>
    </ng-template>

</p-table>
